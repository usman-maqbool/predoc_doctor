
payload = {
  "event_id": "01GGCM7YDJWASE18D91XP91VG9",
  "event_type": "form_response",
  "form_response": {
    "form_id": "SPgNK9UM",
    "token": "01GGCM7YDJWASE18D91XP91VG9",
    "landed_at": "2022-10-27T11:46:36Z",
    "submitted_at": "2022-10-27T11:46:36Z",
    "definition": {
      "id": "SPgNK9UM",
      "title": "all data type form",
      "fields": [
        {
          "id": "KWXLDAuwz0te",
          "ref": "b6b969cc-f6a1-49af-8145-aae3df738d5e",
          "type": "short_text",
          "title": "its a short text",
          "properties": {}
        },
        {
          "id": "HlevVayxvY0v",
          "ref": "5457a1f9-38c1-4e80-929b-8d68c83ee208",
          "type": "long_text",
          "title": "its long text",
          "properties": {}
        },
        {
          "id": "rkcYWCa6ONao",
          "ref": "081cff9a-df78-4338-b3d5-a2706659fce3",
          "type": "phone_number",
          "title": "no filed is ",
          "properties": {}
        },
        {
          "id": "NfYXePxuUhTL",
          "ref": "c7dda70d-884c-4957-9acb-3fb72816ae58",
          "type": "dropdown",
          "title": "add dropdown here",
          "properties": {}
        },
        {
          "id": "xmNXyMZjO1BX",
          "ref": "3a990e2d-fac8-45dd-a9c9-b6b00da0b28c",
          "type": "yes_no",
          "title": "select yes or no",
          "properties": {}
        },
        {
          "id": "Urc4z2X1lQ3v",
          "ref": "f382e61b-5a03-4381-b007-5bf1b9600822",
          "type": "date",
          "title": "enetr date",
          "properties": {}
        },
        {
          "id": "QTJQu3BjwFNb",
          "ref": "1bc18458-9f1f-4d41-9a8b-3f583cbb54a7",
          "type": "multiple_choice",
          "title": "this is a multiple choice",
          "properties": {},
          "choices": [
            {
              "id": "oRXgLZvRl725",
              "label": "No problem"
            },
            {
              "id": "0h5zZuQlTzuS",
              "label": "It's tolerable"
            },
            {
              "id": "AAoQYY76IsiX",
              "label": "It's bad"
            }
          ]
        },
        {
          "id": "mWLqOJdq0RYd",
          "ref": "690897ca-9367-4b5a-b747-5119224e8e73",
          "type": "number",
          "title": "its a number field",
          "properties": {}
        },
        {
          "id": "wmUdmd7uxEht",
          "ref": "fabf2973-442d-4bbd-9b1b-940c03b67cf2",
          "type": "website",
          "title": "its a website link field",
          "properties": {}
        },
        {
          "id": "oXLqQntwn7B5",
          "ref": "ecc84406-3bea-4ee5-a654-685014e328cf",
          "type": "opinion_scale",
          "title": "its a opinion field",
          "properties": {}
        },
        {
          "id": "gFKmPq95YtTM",
          "ref": "b2f7c268-60f1-4784-9284-26bd0a68f742",
          "type": "rating",
          "title": "its a rating field",
          "properties": {}
        },
        {
          "id": "wylgbO6WaQ5J",
          "ref": "76ccf120-7b45-4ad5-b82a-3a582505285b",
          "type": "picture_choice",
          "title": "its a picture field",
          "properties": {},
          "choices": [
            {
              "id": "9urgnepryd7U",
              "label": "choice 1"
            }
          ]
        },
        {
          "id": "fSxYVGXDow0W",
          "ref": "8de505e3-d39d-477f-b17e-f483e45f1abc",
          "type": "email",
          "title": "its an email field",
          "properties": {}
        }
      ]
    },
    "answers": [
      {
        "type": "text",
        "text": "Lorem ipsum dolor",
        "field": {
          "id": "KWXLDAuwz0te",
          "type": "short_text",
          "ref": "b6b969cc-f6a1-49af-8145-aae3df738d5e"
        }
      },
      {
        "type": "text",
        "text": "Lorem ipsum dolor",
        "field": {
          "id": "HlevVayxvY0v",
          "type": "long_text",
          "ref": "5457a1f9-38c1-4e80-929b-8d68c83ee208"
        }
      },
      {
        "type": "phone_number",
        "phone_number": "+34123456789",
        "field": {
          "id": "rkcYWCa6ONao",
          "type": "phone_number",
          "ref": "081cff9a-df78-4338-b3d5-a2706659fce3"
        }
      },
      {
        "type": "choice",
        "choice": {
          "label": "Barcelona"
        },
        "field": {
          "id": "NfYXePxuUhTL",
          "type": "dropdown",
          "ref": "c7dda70d-884c-4957-9acb-3fb72816ae58"
        }
      },
      {
        "type": "boolean",
        "boolean": True,
        "field": {
          "id": "xmNXyMZjO1BX",
          "type": "yes_no",
          "ref": "3a990e2d-fac8-45dd-a9c9-b6b00da0b28c"
        }
      },
      {
        "type": "date",
        "date": "2017-02-06",
        "field": {
          "id": "Urc4z2X1lQ3v",
          "type": "date",
          "ref": "f382e61b-5a03-4381-b007-5bf1b9600822"
        }
      },
      {
        "type": "choice",
        "choice": {
          "label": "Barcelona"
        },
        "field": {
          "id": "QTJQu3BjwFNb",
          "type": "multiple_choice",
          "ref": "1bc18458-9f1f-4d41-9a8b-3f583cbb54a7"
        }
      },
      {
        "type": "number",
        "number": 42,
        "field": {
          "id": "mWLqOJdq0RYd",
          "type": "number",
          "ref": "690897ca-9367-4b5a-b747-5119224e8e73"
        }
      },
      {
        "type": "url",
        "url": "http://example-url.com",
        "field": {
          "id": "wmUdmd7uxEht",
          "type": "website",
          "ref": "fabf2973-442d-4bbd-9b1b-940c03b67cf2"
        }
      },
      {
        "type": "number",
        "number": 42,
        "field": {
          "id": "oXLqQntwn7B5",
          "type": "opinion_scale",
          "ref": "ecc84406-3bea-4ee5-a654-685014e328cf"
        }
      },
      {
        "type": "number",
        "number": 42,
        "field": {
          "id": "gFKmPq95YtTM",
          "type": "rating",
          "ref": "b2f7c268-60f1-4784-9284-26bd0a68f742"
        }
      },
      {
        "type": "choice",
        "choice": {
          "label": "Barcelona"
        },
        "field": {
          "id": "wylgbO6WaQ5J",
          "type": "picture_choice",
          "ref": "76ccf120-7b45-4ad5-b82a-3a582505285b"
        }
      },
      {
        "type": "email",
        "email": "an_account@example.com",
        "field": {
          "id": "fSxYVGXDow0W",
          "type": "email",
          "ref": "8de505e3-d39d-477f-b17e-f483e45f1abc"
        }
      }
    ]
  }
}

class Parser(object):

    def __init__(self, payload):
        self.questions = payload['form_response']['definition']['fields']
        self.answers = payload['form_response']['answers']
        self.formatted_answer = []
        self.formatted_questions = []
        self.questionnaire = []
        self.none_choiced_fields  = ['phone_number', 'date', 'number', 'website', 'opinion_scale', 'email', 'rating', 'short_text', 'long_text', 'yes_no']
        self.choiced_fields  = ['multiple_choice', 'picture_choice']

    def __get_type_question(self, question):
        return question.get('title')


    def __get_type_answer(self, answer):
        if answer.get('type') == 'choice':
            return answer.get('choice').get('label')
        return answer[answer.get('type')]


    def __get_original_question(self, q_payload):
        type = q_payload.get('type')
        if type in self.none_choiced_fields:
          return {
                  'title' : q_payload.get("title"),
                  'choices': None
              }
        elif type in self.choiced_fields:  
          return {
                  'title' : q_payload.get('title'),
                  "choices" : q_payload.get('choices')
              }
        #TODO return defaunt if there are no other type of choices 

    def parse_answers(self):
        for answer in self.answers:
            self.formatted_answer.append(self.__get_type_answer(answer))
        return self.formatted_answer

    def parse_questions(self):
        for question in self.questions:
            self.formatted_questions.append(self.__get_type_question(question))
        return self.formatted_questions

    def parse_original_questionnaire(self):
        for question in self.questions:
            self.questionnaire.append(self.__get_original_question(question))
        return self.questionnaire